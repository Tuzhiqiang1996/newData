<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .ucd-colorpicker-handle {
        position: absolute;
        left: 50%;
        top: 50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        box-shadow: 0px 0.1388rem 0.1388rem rgba(0, 0, 0, 0.2);
        width: 0.9444rem;
        height: 0.9444rem;
        border-radius: 100%;
        border: 0.055rem solid #fff;
      }

      .ucd-colorpicker-wrapper {
        bottom: 1.7819rem;
      }

      .ucd-colorpicker-wrapper {
        width: 6.6666rem;
        margin: 0 auto;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: 2rem;
      }
      .ucd-colorpicker-canvas {
        width: 100%;
      }
      .ucd-colorpicker-handle {
        position: absolute;
        left: 50%;
        top: 50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        box-shadow: 0px 0.1388rem 0.1388rem rgba(0, 0, 0, 0.2);
        width: 0.9444rem;
        height: 0.9444rem;
        border-radius: 100%;
        border: 0.055rem solid #fff;
      }
    </style>
    <script>
      (function () {
        var html = document.documentElement;
        var width = html.getBoundingClientRect().width;
        html.style.fontSize = width / 10 + "px"; //至于除数15可自行设置
        //1rem=50;
      })();
    </script>
    <script src="./jQuery.min.js"></script>
    <script src="./3.js"></script>
    <script src="./4.js"></script>
  </head>
  <body>
    <div class="content ucd-colorpicker">
    <!-- <div class="ucd-colorpicker-wrapper">
      <canvas class="ucd-colorpicker-canvas"></canvas>

      <div
        class="ucd-colorpicker-handle"
        style="
          background-color: rgb(255, 255, 255);
        "
      ></div>
    </div> -->
    </div>

    <!-- <script>
         var t = $("body").find("canvas"),
          e = t[0].getContext("2d"),
          i = 246.6642;

        t.attr({ width: 6 * i, height: 6 * i }),
          (function (t, e, i, n, s) {
            var a = e[0] || e,
              o = e[1] || e,
              r = i[0] || i,
              l = i[1] || i,
              c = 360,
              d = Math.PI / 180;
            for (
              t.save(),
                t.translate(a - r, o - l),
                t.scale(r, l),
                n = c / n || 360;
              c > 0;
              c -= n
            )
              t.beginPath(),
                360 !== n && t.moveTo(1, 1),
                t.arc(1, 1, 1, (c - n / 2 - 1) * d, (c + n / 2 + 1) * d),
                s ? s(t, c) : ((t.fillStyle = "black"), t.fill());
            t.restore();
          })(e, [3 * i, 3 * i], [3 * i - 1, 3 * i - 1], 360, function (t, e) {
            var i = t.createRadialGradient(1, 1, 1, 1, 1, 0);
            i.addColorStop(0, "hsl(" + (360 - e) + ", 100%, 50%)"),
              i.addColorStop(1, "#FFFFFF"),
              (t.fillStyle = i),
              t.fill();
          });



    </script> -->
    <!-- <script>
        var div =$('.ucd-colorpicker-handle')[0];


    var startX = 0; // 获取手指初始坐标
    var startY = 0;
    var x = 0; // 获得盒子原来的位置
    var y = 0;
    // 手指触摸
    div.addEventListener('touchstart', function(e) {
      // 获取手指初始坐标
      startX = e.targetTouches[0].pageX;
      startY = e.targetTouches[0].pageY;
      x = this.offsetLeft;
      y = this.offsetTop;
      this.style.boxShadow = '0 0 15px rgba(0, 0, 0, .6)';
    });
    // 手指离开
    div.addEventListener('touchend', function(e) {
      this.style.boxShadow = '';
    });

    // 手指按住移动
    div.addEventListener('touchmove', function(e) {
      // 计算手指的移动距离：手指移动之后的坐标减去手指初始的坐标
      var moveX = e.targetTouches[0].pageX - startX;
      var moveY = e.targetTouches[0].pageY - startY;
      //


            //
      // 移动盒子 盒子原来的位置 + 手指移动的距离
      this.style.left = x + moveX + 'px';
      this.style.top = y + moveY + 'px';
      e.preventDefault(); // 阻止屏幕滚动的默认行为
    });
    </script> -->
    <script>
      (function () {
        var that = this;
        that._color = { r: 255, g: 255, b: 255 };
        that.opts = {
          d :246.6642,
          dots:[
          { color: "101, 101, 255" },
          { color: "255, 252, 150" },
          { color: "" },
          { color: "221, 89, 255" },
          { color: "105, 255, 120" },
        ],

        }
        that.canvasOffset={
          top:"123.332px",
          left:"123.332px"
        }
        // that.opts.d = 246.6642;
        // that.opts.dots = [
        //   { color: "101, 101, 255" },
        //   { color: "255, 252, 150" },
        //   { color: "" },
        //   { color: "221, 89, 255" },
        //   { color: "105, 255, 120" },
        // ];


        function _trigger(e, i, n) {
          var s,
            a,
            o = that.opts[e];
          if (
            ((n = void 0 === n ? {} : n),
            ((i = t.Event(i)).type = e.toLowerCase()),
            (i.target = $("body")[0]),
            (a = i.originalEvent))
          )
            for (s in a) s in i || (i[s] = a[s]);
          return (
            $("body").trigger(i, n),
            !(
              (t.isFunction(o) &&
                !1 === o.apply($("body")[0], [i].concat(n))) ||
              i.isDefaultPrevented()
            )
          );
        }
        function _bindDotDrag(t) {
          var i = that,
            n = that.document,
            s = ".ucd.colorpickerdot",
            a = e.Events.getEvent(t),
            o = a.pageX,
            r = a.pageY,
            l = o,
            c = r;
          i._onDotStart(t),
            n
              .on(e.Events.MOVE + s, function (t) {
                var n = e.Events.getEvent(t);
                (l = n.pageX), (c = n.pageY), i._onDotDragging(t, l - o, c - r);
              })
              .on(e.Events.UP + s, function (t) {
                n.off(e.Events.MOVE + s + " " + e.Events.UP + s),
                  i._onDotEnd(t);
              });
        }
        function _onDotStart(e) {
          e.preventDefault(), e.stopPropagation();
          var i = t(e.target),
            n = 0,
            s = that,
            a = (that.timerId = setInterval(function () {
              if (++n >= 6)
                return (
                  s.element.addClass("ucd-long-press"),
                  i.addClass("dot-add").attr("style", ""),
                  void clearTimeout(a)
                );
            }, 100));
          _trigger("onDragStart", e);
        }
        function _onDotDragging(t, e, i) {
          t.preventDefault(),
            t.stopPropagation(),
            (Math.abs(e) > 5 || Math.abs(i) > 5) && clearTimeout(that.timerId);
        }
        function _onDotEnd(e) {
          if (
            (e.preventDefault(),
            e.stopPropagation(),
            clearTimeout(that.timerId),
            $("body").hasClass("ucd-long-press"))
          )
            $("body").removeClass("ucd-long-press");
          else {
            var i =
                0 == e.target.className.indexOf("dot")
                  ? t(e.target)
                  : t(e.target.children[0]),
              n = i.css("backgroundColor"),
              s = 0,
              a = {};
            i.hasClass("dot-add")
              ? ((s = i.closest("li").index()),
                (a = that.colors.getColor("rgb")),
                i
                  .css(
                    "backgroundColor",
                    that.colors.toString("rgb", !1).replace(/, /g, ",")
                  )
                  .removeClass("dot-add"),
                (that.opts.dots[s] = { color: [a.r, a.g, a.b].join(" ,") }))
              : ( setColor(n), _trigger("change", null, that._color)),
              _trigger("onDragEnd", e);
          }
        }
        function _bindDrag(i) {
          var n = that,
            s = $('.ucd-colorpicker-handle'),
            // s = t(document),
            a = ".ucd.colorpicker",
            o = _getHandle(),
            r = e.Events.getEvent(i),
            l = r.pageX,
            c = r.pageY;
           _onDragStart(o, i),
            s
              .on(e.Events.MOVE + a, function (t) {
                var i = e.Events.getEvent(t);
                (l = i.pageX), (c = i.pageY), _onDragging(o, t, l, c);
              })
              .on(e.Events.UP + a, function (t) {
                s.off(e.Events.MOVE + a + " " + e.Events.UP + a),
                  _onDragEnd(o, t, l, c);
              });
        }
        function _onDragStart(t, e) {
          e.preventDefault(),
            e.stopPropagation(),
            $("body").addClass("ucd-colorpicker-drag"),
            (that.canvasOffset = that.$canvas.offset()),
            _trigger("onDragStart", e);
        }
        function _onDragging(t, e, i, n) {
          e.preventDefault(), e.stopPropagation(), _onMove(t, i, n);
        }
        function _onDragEnd(t, e, i, n) {
          e.preventDefault(),
            e.stopPropagation(),
            _onMove(t, i, n),
            $("body").removeClass("ucd-colorpicker-drag"),
            _trigger("change", null, that._color),
            _trigger("onDragEnd", e);
        }
        function _onMove(t, e, i) {
          console.log('ds');
          var n,
            s = that.canvasOffset.left,
            a = that.canvasOffset.top,
            o = that.colors,
            r = that.opts.d / 2;
          (n = (function (t, e, i, n) {
            var s, a;
            return (
              (s =
                360 - ((180 * Math.atan2(i, e)) / Math.PI + (i < 0 ? 360 : 0))),
              (a = (Math.sqrt(e * e + i * i) / n) * 100),
              setColor({ h: s, s: a, v: 100 }, "hsv"),
              getColor("rgb")
            );
          })(o, e - s - r, i - a - r, r)),
             _update(t, n, !0);
        }
        function _updateUI(t, e) {

          var i = e,
            n = getColor(),
            s = 2 * Math.PI,
            a = that.opts.d,
            o = Math.cos(s - n.hsv.h * s),
            r = Math.sin(s - n.hsv.h * s),
            l = n.hsv.s * (a / 2),
            c = o * l + a / 2,
            d = r * l + a / 2;
          i.css({
            left: c,
            top: d,
            backgroundColor: t.toString("rgb", !1).replace(/, /g, ","),
          });
        }
        function _update(t, e, i) {


          return (
            (!i || !1 !== _trigger("change", null, e)) &&
            e !== that._color &&
            ((that._color = { r: e.r, g: e.g, b: e.b }),
            _updateUI(that.colors, t),
            void (i && _trigger("change", null, that._color)))
          );
        }
        // function _getHandle() {
        //   return that.$handle && that.$handle.length
        //     ? that.$handle
        //     : $("body").find(".ucd-colorpicker-handle");
        // }
        function _getHandle() {
          return  $("body").find(".ucd-colorpicker-handle")
        }
        function setColor(t, e) {
           setColor(t, e),
            (t =  getColor("rgb")),
             _update(_getHandle(), t);
        }
        function getColor() {
          return that._color;
        }
        function getDots() {
          return that.opts.dots;
        }
        console.log("ee", that);


      })();
    </script>
  </body>
</html>
